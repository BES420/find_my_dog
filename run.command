#!/bin/bash

# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd "$(dirname "$0")"

echo "üîç –ü—Ä–æ–≤–µ—Ä—è—é –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ –∏–Ω—Å—Ç–∞–Ω—Å—ã –±–æ—Ç–∞..."

# –ò—â–µ–º –ø—Ä–æ—Ü–µ—Å—Å—ã Python –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–ø—É—Å–∫–∞—é—Ç –±–æ—Ç–∞ –∏ —É–±–∏–≤–∞–µ–º –∏—Ö
BOT_PROCESSES=$(ps aux | grep -i "python.*tg_bot_pet911" | grep -v grep | awk '{print $2}')

if [ -n "$BOT_PROCESSES" ]; then
    echo "üî• –ù–∞–π–¥–µ–Ω—ã –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ –∏–Ω—Å—Ç–∞–Ω—Å—ã –±–æ—Ç–∞, —É–±–∏–≤–∞—é –∏—Ö:"
    for pid in $BOT_PROCESSES; do
        echo "   –£–±–∏–≤–∞—é –ø—Ä–æ—Ü–µ—Å—Å $pid"
        kill -9 $pid
    done
    echo "‚úÖ –°—Ç–∞—Ä—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã —É–±–∏—Ç—ã"
else
    echo "‚úÖ –ó–∞–ø—É—â–µ–Ω–Ω—ã—Ö –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤ –±–æ—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ"
fi

# –î–∞–µ–º –Ω–µ–º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
sleep 1

# –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
echo "üîß –ê–∫—Ç–∏–≤–∏—Ä—É—é –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ..."
if [ -d "venv" ]; then
    source venv/bin/activate
elif [ -d ".venv" ]; then
    source .venv/bin/activate
else
    echo "‚ùå –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ (–Ω–∏ venv, –Ω–∏ .venv)"
    echo "‚ö†Ô∏è –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: pip install -r requirements.txt"
fi

# –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–æ–≤–æ–≥–æ –±–æ—Ç–∞
echo "üöÄ –ó–∞–ø—É—Å–∫–∞—é –Ω–æ–≤—ã–π –∏–Ω—Å—Ç–∞–Ω—Å –±–æ—Ç–∞..."
python -m tg_bot_pet911.main

# –î–µ—Ä–∂–∏–º —Ç–µ—Ä–º–∏–Ω–∞–ª –æ—Ç–∫—Ä—ã—Ç—ã–º –µ—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞
echo "‚ùå –ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
read -p "–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –æ–∫–Ω–∞..." 